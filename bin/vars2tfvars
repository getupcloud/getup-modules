#!/usr/bin/env python

import hcl2
import sys
import json

hcl = hcl2.api.load(sys.stdin)

print(f'# File auto-generated from {sys.argv[0]}')
print()

def fix_string(s):
    return s.replace('\'', '"').replace('\n', '\n #')

for i, variable in enumerate(hcl.get('variable')):
    for name, content in variable.items():
        description = content.get('description')
        data_type = content.get('type')
        has_default, default = 'default' in content, content.get('default')

        if default is None:
            default = 'null'
        elif data_type == '${string}':
            default = default # f'"{default}"'
        elif data_type == '${bool}':
            default = 'true' if default else 'false'

        if i:
            print()

        if description is not None:
            print(fix_string(f'# {name} - {description}'))

        if data_type is not None:
            print(fix_string(f'# Type: {data_type}'))


        if has_default:
            print(fix_string(f'# Default: {json.dumps(default)}'))
        else:
            print(f'# Required')

        if has_default:
            print(fix_string(f'#{name} = {json.dumps(default)}'))
        else:
            print(f'#{name} = <REQUIRED-VALUE>')

